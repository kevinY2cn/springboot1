<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="dk.mapper.DkItemMapper">

	<select id="getRowCount" resultType="Integer">
		select count(*) from dkitem where item_delete_flag = 0;
	</select>

	<select id="getListByPage" resultMap="dkItemResult">
		select * from dkitem where item_delete_flag = 0 limit #{offset},#{limit}
	</select>

	<insert id="addItem" useGeneratedKeys="true" keyProperty="itemId">
	
		insert into dkitem(item_name,item_category,item_count,item_unit,item_origin)
		<include refid="insert_values">
		</include>
	</insert>
	
	
	<update id="updateList">
		update dkitem 
		<trim prefix="set" suffixOverrides=",">
	        <trim prefix="item_name = case" suffix="end,">
	          <foreach collection="list" item="item">
	            <if test="item.name != null">
	              when item_id=#{item.itemId} then #{item.name}
	            </if>
	          </foreach>
	        </trim>
      	</trim>
      	<trim prefix="where">
      		 <trim prefix="item_id in (" suffix=")">
      		 	<trim suffixOverrides="," >
	      		 	<foreach collection="list" item="item">
			            #{item.itemId},
		          	</foreach>
	          	</trim>
      		 </trim>
      	</trim>
	</update>
	
	<!-- <delete id="deleteItem">
		delete from dkitem where item_id = #{itemId}
	
	</delete> -->
	
 	<update id="deleteItem">
		update dkitem set item_delete_flag = 1 where item_id = #{itemId}
	</update>
	
	
	<update id="batchDelete">
		update dkitem set item_delete_flag = 1
		where
		<trim prefix="item_id in(" suffix=")">
			<trim suffixOverrides=",">
				<foreach collection="list" item="item">
					#{item.itemId},
				</foreach>
			</trim>
		</trim>
	</update>
	
	<insert id="addItemList" useGeneratedKeys="true" keyProperty="itemId">
	
		insert into dkitem(item_name,item_category,item_count,item_unit,item_origin)
		values
		<foreach collection="list" item="item" separator=",">
			(
			#{item.name},
			#{item.category},
			#{item.count},
			#{item.unit},
			#{item.origin}
			)
		</foreach>
	</insert>
	
	<sql id="insert_values">
		values (
				#{name},
				#{category},
				#{count},
				#{unit},
				#{origin}
				)
	</sql>

	<resultMap id="dkItemResult" type="dkItem">
		<id property="itemId" column="item_id"></id>
		<result property="name" column="item_name"/>
		<result property="category" column="item_category"/>
		<result property="count" column="item_count"/>
		<result property="unit" column="item_unit"/>
		<result property="origin" column="item_origin"/>
		<result property="date" column="item_date" javaType="java.util.Date" jdbcType="TIMESTAMP"/>
	</resultMap>
</mapper>